# ============================================================================
# mpv broadcast suite configuration
# ============================================================================
# Professional configuration for broadcast engineers and QC operators
#
# Optimised for:
#   • Frame-accurate review and quality control
#   • Multi-channel audio monitoring
#   • High-quality screenshot capture
#   • Stable, reproducible playback
#
# Performance Notes:
#   • Hardware decode enabled by default (auto-safe)
#   • Interpolation disabled for frame accuracy
#   • Large demuxer buffer for smooth scrubbing
#
# Author: mpv Broadcast Suite Contributors
# License: MIT
# Version: 1.0.0
# ============================================================================

# ============================================================================
# VIDEO OUTPUT & RENDERING
# ============================================================================

# Video output driver
# 'gpu' provides best compatibility across platforms
# Alternative: 'gpu-next' for cutting-edge features (may be unstable)
vo=gpu

# High-quality rendering profile
# Enables advanced scaling and processing algorithms
profile=gpu-hq

# GPU API selection
# auto: Automatically select best available (Vulkan > D3D11 > OpenGL)
# Specific APIs: vulkan, d3d11, opengl, metal (macOS)
gpu-api=auto

# Hardware decoding
# auto-safe: Enable hardware decode when format/codec is known-safe
# auto: More aggressive, may have compatibility issues
# no: Software decode only (high CPU usage, better compatibility)
# Specific: vaapi (Linux), videotoolbox (macOS), d3d11va/nvdec (Windows)
hwdec=auto-safe

# ============================================================================
# VIDEO PROCESSING & QUALITY
# ============================================================================

# Frame timing and synchronisation
# display-resample: Smooth playback by resampling to display rate
# audio: Sync video to audio (more frame-accurate, may stutter)
# desync: No sync, fastest but can drift
video-sync=display-resample

# Temporal interpolation (motion smoothing)
# no: Disabled for frame-accurate QC (recommended)
# yes: Enable for smoother playback (not suitable for QC work)
interpolation=no

# Upscaling algorithm (when video < display resolution)
# ewa_lanczossharp: High quality, good balance
# Alternatives: spline36, mitchell, lanczos, bilinear
scale=ewa_lanczossharp

# Chroma upscaling (colour information)
# ewa_lanczossharp: Match luma for consistency
cscale=ewa_lanczossharp

# Downscaling algorithm (when video > display resolution)
# mitchell: Good quality, reasonable performance
dscale=mitchell

# Dithering reduces banding artefacts
# fruit: High-quality dithering algorithm
# Alternatives: ordered, error-diffusion, no
dither=fruit

# ============================================================================
# COLOUR MANAGEMENT
# ============================================================================

# Target colour primaries
# auto: Match display capabilities
# bt.709: Rec. 709 (HD standard)
# bt.2020: Rec. 2020 (UHD/HDR standard)
target-prim=auto

# Target transfer characteristics (gamma curve)
# auto: Match display
# bt.1886: Standard for HD/SDR
# pq: Perceptual Quantizer (HDR10)
# hlg: Hybrid Log-Gamma (HDR broadcast)
target-trc=auto

# ICC colour profile support
# Automatically load and apply display ICC profile
icc-profile-auto=yes

# Tone mapping for HDR → SDR
# hable: Hable filmic tone mapping (good default)
# mobius: Preserves detail in highlights
# reinhard: Simple, fast
# bt.2390: ITU-R BT.2390 (broadcast standard)
tone-mapping=hable

# ============================================================================
# AUDIO CONFIGURATION
# ============================================================================

# Audio output channel layout
# auto: Automatically match source and device
# stereo: Force stereo downmix
# 5.1, 7.1: Force specific layout
audio-channels=auto

# Decoder downmix behaviour
# yes: Allow decoder to downmix multi-channel to stereo
# no: Pass through all channels unchanged
ad-lavc-downmix=yes

# Normalise downmix levels
# yes: Prevent clipping when downmixing
# no: Preserve original levels
audio-normalize-downmix=yes

# Pitch correction during speed changes
# yes: Maintain pitch when playing at non-1.0 speed
# no: Chipmunk/slow-mo effect
audio-pitch-correction=yes

# Audio buffer duration (seconds)
# Larger = more stable, higher latency
# Smaller = lower latency, risk of underruns
audio-buffer=1.0

# Silence audio stream on pause
# yes: Prevent popping/clicking on pause/unpause
audio-stream-silence=yes

# Volume control
volume=100            # Default volume (0-100, or higher with volume-max)
volume-max=150        # Allow volume boost to 150% for quiet content

# ============================================================================
# ON-SCREEN DISPLAY (OSD)
# ============================================================================

# Built-in on-screen controller
# no: Disabled (we use custom Lua scripts)
# yes: Enable default OSC
osc=no

# Progress bar on seeking
# yes: Show bar when seeking
# no: No visual feedback
osd-bar=yes

# What to show when seeking
# bar: Only progress bar
# msg: Progress bar with text
# msg-bar: Full OSD
osd-on-seek=bar

# OSD message duration (milliseconds)
osd-duration=1500

# OSD font settings (for fallback messages)
osd-font="Consolas"
osd-font-size=32
osd-color="#FFFFFF"
osd-border-color="#000000"
osd-border-size=2
osd-shadow-offset=2

# OSD positioning
# left/center/right, top/center/bottom
osd-align-x=left
osd-align-y=top
osd-margin-x=24
osd-margin-y=24

# ============================================================================
# PLAYBACK BEHAVIOUR
# ============================================================================

# Keep player open when file ends
# yes: Stay open at last frame (essential for QC)
# no: Close immediately
# always: Stay open even if file fails to load
keep-open=yes

# Pause at end of file
# yes: Pause on last frame
# no: Continue to stay at end without pausing
keep-open-pause=no

# Loop behaviour
# inf: Loop forever
# no: Play once (default)
# N: Loop N times
loop-file=no

# ============================================================================
# SEEKING & NAVIGATION
# ============================================================================

# High-resolution seeking
# yes: Frame-accurate seeking (essential for QC)
# no: Keyframe-only seeking (faster but imprecise)
hr-seek=yes

# Framedrop behaviour during seeking
# yes: Drop frames for faster seeking
# no: Decode all frames (slower but more accurate)
hr-seek-framedrop=no

# ============================================================================
# CACHING & BUFFERING
# ============================================================================

# Enable cache for all playback
# yes: Buffer data in RAM
# no: No buffering (direct playback)
cache=yes

# Cache duration (seconds)
# How many seconds of video to pre-buffer
cache-secs=10

# Maximum cache size (bytes)
# Larger = smoother scrubbing, more RAM usage
# 500M = 500 megabytes
demuxer-max-bytes=500M

# Read-ahead duration (seconds)
# How far ahead to read when buffering
demuxer-readahead-secs=20

# Backwards cache (bytes)
# Allows seeking backwards without re-reading
demuxer-max-back-bytes=200M

# ============================================================================
# SCREENSHOT CONFIGURATION
# ============================================================================

# Screenshot format
# png: Lossless, large files
# jpg: Lossy, smaller files
# webp: Modern format, good compression
screenshot-format=png

# PNG compression level (0-9)
# 0: No compression (fast, large)
# 9: Maximum compression (slow, small)
# 5: Good balance
screenshot-png-compression=5

# Screenshot filename template
# %F: Filename without extension
# %p: Current timestamp
# %P: Timestamp in HH:MM:SS format
# %n: Sequential number
screenshot-template="%F_frame_%p"

# Screenshot save directory
# ~ expands to home directory
# Absolute path: /path/to/screenshots
screenshot-directory="~/mpv_screenshots"

# High bit-depth screenshots
# yes: Preserve 10-bit/HDR content
# no: Convert to 8-bit
screenshot-high-bit-depth=yes

# Include subtitles in screenshots
# video: No subtitles (clean video frame)
# subtitles: Include rendered subtitles
# window: Include full player window
screenshot-sw=no

# ============================================================================
# SUBTITLE CONFIGURATION
# ============================================================================

# Automatic subtitle loading
# exact: Load if filename matches exactly
# fuzzy: Load if filename is similar
# all: Load all subtitles in directory
# no: Don't auto-load
sub-auto=fuzzy

# Subtitle font
sub-font="Arial"
sub-font-size=48
sub-color="#FFFFFF"
sub-border-color="#000000"
sub-border-size=2.5
sub-shadow-offset=1
sub-shadow-color="#000000"

# Subtitle positioning
# Percentage from bottom of screen
sub-pos=95

# ============================================================================
# WINDOW & DISPLAY
# ============================================================================

# Force window creation
# immediate: Create window before loading file
# yes: Create window when playing
# no: Wait for user action
force-window=immediate

# Default window size
# 50%: Half of screen height
# 1920x1080: Specific resolution
# WxH: Width and height in pixels
autofit=85%

# Window always on top
# yes: Stay above other windows
# no: Normal window behaviour
ontop=no

# Window borders
# yes: Show window decorations
# no: Borderless window
border=yes

# Title bar text format
# ${filename}: Show filename
# ${media-title}: Show media title if available
# Custom: "mpv - ${filename}"
title="${?media-title:${media-title}}${!media-title:No file}"

# ============================================================================
# FULLSCREEN
# ============================================================================

# Start in fullscreen
# yes: Always start fullscreen
# no: Windowed mode
fs=no

# Fullscreen monitor
# 0: Primary monitor
# 1: Secondary monitor
# current: Monitor where window is located
fs-screen=0

# ============================================================================
# PERFORMANCE & THREADING
# ============================================================================

# Video decoder threads
# 0: Auto-detect CPU cores
# N: Use N threads
vd-lavc-threads=0

# Display sync method
# desync: No sync (lowest CPU)
# audio: Sync to audio
# display-resample: Sync to display with resampling
# display-vdrop: Sync to display, drop frames if needed
# display-adrop: Sync to display, drop audio if needed
# Default set above: display-resample

# ============================================================================
# CACHE DIRECTORIES
# ============================================================================

# Shader cache (improves startup time)
gpu-shader-cache-dir="~/.cache/mpv/shaders"

# ICC profile cache
icc-cache-dir="~/.cache/mpv/icc"

# ============================================================================
# FILE HANDLING
# ============================================================================

# Ordered chapters (Matroska)
# yes: Follow ordered chapter links
# no: Ignore
ordered-chapters=yes

# Merge external files
# no: Treat each file separately
# yes: Merge consecutive files
merge-files=no

# Resume playback position
# yes: Remember position for each file
# no: Always start from beginning (recommended for QC)
save-position-on-quit=no

# Watch-later directory (for save-position-on-quit)
watch-later-directory="~/.config/mpv/watch_later"

# ============================================================================
# NETWORK STREAMING
# ============================================================================

# User agent for HTTP streams
# Default identifies as mpv
user-agent="mpv ${mpv-version}"

# Network timeout (seconds)
network-timeout=60

# Stream cache for network playback
stream-buffer-size=4M

# ============================================================================
# LOGGING & DEBUG
# ============================================================================

# Message verbosity
# Levels: no, fatal, error, warn, info, status, v, debug, trace
# Comment out for normal operation
# msg-level=all=info

# Log to file
# Uncomment and set path for persistent logging
# log-file=~/mpv.log

# Terminal output
# yes: Print status to terminal
# no: Silent operation
term-osd-bar=yes

# ============================================================================
# CUSTOM PROFILES
# ============================================================================
# Profiles allow quick switching between different configurations
# Activate with: mpv --profile=profile-name file.mp4
# Or during playback: press ` and type: apply-profile profile-name

# ──────────────────────────────────────────────────────────────────────────
# Broadcast-specific profiles
# ──────────────────────────────────────────────────────────────────────────

[broadcast-pal]
profile-desc="PAL broadcast (50 fps)"
# Add PAL-specific settings here if needed

[broadcast-ntsc]
profile-desc="NTSC broadcast (59.94 fps)"
# Add NTSC-specific settings here if needed

# ──────────────────────────────────────────────────────────────────────────
# Quality control profiles
# ──────────────────────────────────────────────────────────────────────────

[qc-accurate]
profile-desc="QC Mode: Frame-accurate, no interpolation"
# Absolute frame accuracy for quality control
video-sync=audio              # Lock to audio timing
interpolation=no              # No frame blending
framedrop=no                  # Never drop frames
hr-seek-framedrop=no          # Decode all frames when seeking
deinterlace=no                # No automatic deinterlacing

[qc-realtime]
profile-desc="Real-time monitoring mode"
# Smooth playback prioritised over absolute accuracy
video-sync=display-resample   # Resample to display rate
interpolation=yes             # Enable motion smoothing
framedrop=vo                  # Allow dropping to maintain sync

# ──────────────────────────────────────────────────────────────────────────
# Content-specific profiles
# ──────────────────────────────────────────────────────────────────────────

[hdr]
profile-desc="HDR content (PQ/HLG)"
# Proper HDR tone mapping and colour handling
target-trc=pq                 # PQ transfer for HDR10
target-prim=bt.2020           # Wide colour gamut
tone-mapping=bt.2390          # ITU broadcast tone mapping
tone-mapping-param=default

[slowmo]
profile-desc="Slow-motion review (0.25x speed)"
# Frame-by-frame analysis at reduced speed
speed=0.25                    # Quarter speed
audio-pitch-correction=no     # Disable pitch shift for clarity

# ──────────────────────────────────────────────────────────────────────────
# File type optimisation
# ──────────────────────────────────────────────────────────────────────────

[large-files]
profile-desc="Optimisation for large files (>50GB)"
# Enhanced buffering for very large files
demuxer-max-bytes=1G          # 1GB demuxer buffer
demuxer-readahead-secs=60     # 60 seconds read-ahead
cache-secs=30                 # 30 seconds cache
demuxer-max-back-bytes=500M   # 500MB backwards buffer

[low-latency]
profile-desc="Minimal latency for live monitoring"
# Reduce delays for real-time monitoring
cache=no                      # Disable cache
video-sync=audio              # Sync to audio
interpolation=no              # No interpolation
audio-buffer=0.05             # 50ms audio buffer
untimed=yes                   # Ignore timestamps

# ──────────────────────────────────────────────────────────────────────────
# Network streaming profiles
# ──────────────────────────────────────────────────────────────────────────

[stream-monitor]
profile-desc="Live stream monitoring (UDP/RTMP/SRT)"
# Optimised for network streams
cache=yes
cache-secs=2                  # Small cache for low latency
demuxer-readahead-secs=2
video-sync=audio
framedrop=vo                  # Drop frames if needed
untimed=yes

# ============================================================================
# SCRIPT CONFIGURATION
# ============================================================================
# Lua scripts are loaded automatically from scripts/ directory
# Place evs_timecode.lua and audiomap.lua in:
#   Linux/macOS: ~/.config/mpv/scripts/
#   Windows: %APPDATA%\mpv\scripts\

# Script-specific options can be set here
# Format: script-opts=scriptname-option=value

# Example: Customise timecode script
# script-opts=evs_timecode-mode=full,evs_timecode-tc_size=80

# ============================================================================
# INPUT CONFIGURATION
# ============================================================================
# Custom keybindings are loaded from input.conf in the same directory
# See input.conf for complete keyboard reference

# ============================================================================
# NOTES
# ============================================================================
# 
# Activating Profiles:
#   Command line: mpv --profile=qc-accurate file.mp4
#   During playback: Press ` (backtick) and type: apply-profile qc-accurate
#
# Multiple Profiles:
#   mpv --profile=qc-accurate --profile=hdr file.mp4
#
# Temporary Overrides:
#   mpv --speed=0.5 --loop-file file.mp4
#
# Configuration Priority:
#   1. Command-line options (highest)
#   2. File-specific profiles (applied automatically)
#   3. User profiles (applied manually)
#   4. This config file
#   5. mpv defaults (lowest)
#
# Testing Configuration:
#   mpv --msg-level=all=info test.mp4
#   (Shows detailed information about settings in use)
#
# Documentation:
#   man mpv
#   https://mpv.io/manual/stable/
#
# ============================================================================

