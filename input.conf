# ============================================================================
# mpv broadcast suite keyboard bindings
# ============================================================================
# Keyboard shortcuts hopefulla useful for engineers and QC ops
#
# Modifier Keys:
#   Ctrl  = Control key
#   Alt   = Alt/Option key
#   Shift = Shift key
#   Meta  = Windows/Command key
#
# Syntax:
#   KEY command1; command2; ...
#   Comments start with #
#   Blank lines are ignored
#
# Special Keys:
#   BS = Backspace, ENTER = Return/Enter, ESC = Escape
#   SPACE = Spacebar, TAB = Tab
#   Arrows: UP, DOWN, LEFT, RIGHT
#   Function: F1-F12
#   Modifiers: PGUP, PGDWN, HOME, END, INS, DEL
#
# Author: mpv Broadcast Suite Contributors
# License: MIT
# Version: 1.0.0
# ============================================================================

# ============================================================================
# TIMECODE DISPLAY CONTROL
# ============================================================================
# Broadcast-style timecode overlay management

# Cycle timecode display modes: Full → TC Only → Minimal → Off → Full
t script-message-to timecode cycle_mode

# Toggle countdown display in full mode
Ctrl+t script-message-to timecode toggle_countdown

# ============================================================================
# AUDIO CHANNEL ROUTING
# ============================================================================
# Multi-channel audio control and loudness management

# ──────────────────────────────────────────────────────────────────────────
# Reset and intelligent downmix
# ──────────────────────────────────────────────────────────────────────────

# Ctrl+0: Full audio reset + RMS-normalised all→stereo downmix
# Clears all filters and applies intelligent summation for multi-channel audio
Ctrl+0 script-message-to audiomap reset

# ──────────────────────────────────────────────────────────────────────────
# Stereo pair routing (CH1+2, CH3+4, ..., CH15+16)
# ──────────────────────────────────────────────────────────────────────────
# Route specific stereo pairs from embedded multi-channel audio
# Pair 1 = CH1+2 (c0+c1), Pair 2 = CH3+4 (c2+c3), etc.

Ctrl+1 script-message-to audiomap pair 1    # Route CH1+2
Ctrl+2 script-message-to audiomap pair 2    # Route CH3+4
Ctrl+3 script-message-to audiomap pair 3    # Route CH5+6
Ctrl+4 script-message-to audiomap pair 4    # Route CH7+8
Ctrl+5 script-message-to audiomap pair 5    # Route CH9+10
Ctrl+6 script-message-to audiomap pair 6    # Route CH11+12
Ctrl+7 script-message-to audiomap pair 7    # Route CH13+14
Ctrl+8 script-message-to audiomap pair 8    # Route CH15+16

# ──────────────────────────────────────────────────────────────────────────
# Solo channel monitoring (mono → stereo)
# ──────────────────────────────────────────────────────────────────────────
# Route single channel to both L+R outputs for isolated listening

# Channels 1-8
Ctrl+Alt+1 script-message-to audiomap solo 1    # Solo CH1
Ctrl+Alt+2 script-message-to audiomap solo 2    # Solo CH2
Ctrl+Alt+3 script-message-to audiomap solo 3    # Solo CH3
Ctrl+Alt+4 script-message-to audiomap solo 4    # Solo CH4
Ctrl+Alt+5 script-message-to audiomap solo 5    # Solo CH5
Ctrl+Alt+6 script-message-to audiomap solo 6    # Solo CH6
Ctrl+Alt+7 script-message-to audiomap solo 7    # Solo CH7
Ctrl+Alt+8 script-message-to audiomap solo 8    # Solo CH8

# Channels 9-16 (extended)
Ctrl+Alt+Shift+1 script-message-to audiomap solo 9     # Solo CH9
Ctrl+Alt+Shift+2 script-message-to audiomap solo 10    # Solo CH10
Ctrl+Alt+Shift+3 script-message-to audiomap solo 11    # Solo CH11
Ctrl+Alt+Shift+4 script-message-to audiomap solo 12    # Solo CH12
Ctrl+Alt+Shift+5 script-message-to audiomap solo 13    # Solo CH13
Ctrl+Alt+Shift+6 script-message-to audiomap solo 14    # Solo CH14
Ctrl+Alt+Shift+7 script-message-to audiomap solo 15    # Solo CH15
Ctrl+Alt+Shift+8 script-message-to audiomap solo 16    # Solo CH16

# ──────────────────────────────────────────────────────────────────────────
# Loudness normalisation control
# ──────────────────────────────────────────────────────────────────────────

# Cycle loudness targets: None → EBU R128 (-23 LUFS) → ATSC (-24 LUFS) → Podcast (-16 LUFS) → None
Ctrl+l script-message-to audiomap toggle_loudness

# Display detailed audio information
# Shows: tracks, channels, codec, sample rate, active mode, loudness target
Ctrl+i script-message-to audiomap show_audio_info

# ============================================================================
# PLAYBACK CONTROL
# ============================================================================
# Frame-accurate navigation and speed control

# ──────────────────────────────────────────────────────────────────────────
# Frame stepping (frame-accurate QC)
# ──────────────────────────────────────────────────────────────────────────

. frame-step          # Step forward one frame (period key)
, frame-back-step     # Step backward one frame (comma key)

# ──────────────────────────────────────────────────────────────────────────
# Speed control
# ──────────────────────────────────────────────────────────────────────────

[ multiply speed 0.5     # Halve playback speed (0.5x)
] multiply speed 2.0     # Double playback speed (2.0x)
BS set speed 1.0         # Reset to normal speed (Backspace)

# Alternative fine speed control
{ add speed -0.1         # Decrease speed by 10%
} add speed 0.1          # Increase speed by 10%

# ──────────────────────────────────────────────────────────────────────────
# Seeking (navigation)
# ──────────────────────────────────────────────────────────────────────────

# Standard seeks (exact positioning)
RIGHT seek 1 exact       # Seek forward 1 second
LEFT seek -1 exact       # Seek backward 1 second
UP seek 5 exact          # Seek forward 5 seconds
DOWN seek -5 exact       # Seek backward 5 seconds

# Extended seeks
Shift+RIGHT seek 10 exact         # Seek forward 10 seconds
Shift+LEFT seek -10 exact         # Seek backward 10 seconds
Ctrl+RIGHT seek 60 exact          # Seek forward 1 minute
Ctrl+LEFT seek -60 exact          # Seek backward 1 minute

# Jump to position
HOME seek 0 absolute              # Jump to beginning
END seek 100 absolute-percent     # Jump to end

# ──────────────────────────────────────────────────────────────────────────
# Pause and frame hold
# ──────────────────────────────────────────────────────────────────────────

SPACE cycle pause                 # Toggle pause
p cycle pause                     # Alternative pause toggle

# ============================================================================
# METADATA & INFORMATION DISPLAY
# ============================================================================

# Quick metadata overlay (3 seconds)
# Shows: filename, resolution, framerate, codecs, audio configuration
i show-text "File: ${filename}\nRes: ${width}x${height} @ ${container-fps} fps\nVideo: ${video-codec}\nAudio: ${audio-codec} | ${audio-params/channels}ch @ ${audio-params/samplerate}Hz\nDuration: ${duration}" 3

# Extended statistics (toggle)
# Shows: dropped frames, cache status, bitrate, etc.
I script-binding stats/display-stats-toggle

# Console for advanced commands
` script-binding console/enable    # Open console (backtick key)

# ============================================================================
# SCREENSHOT CAPTURE
# ============================================================================

# Screenshot current frame (video only, no OSD/subtitles)
s screenshot video

# Screenshot with subtitles and OSD
S screenshot

# Screenshot with window borders
Alt+s screenshot window

# ============================================================================
# VIDEO INSPECTION TOOLS
# ============================================================================

# ──────────────────────────────────────────────────────────────────────────
# Zoom and pan (for detail inspection)
# ──────────────────────────────────────────────────────────────────────────

# Zoom control
Alt+UP add video-zoom 0.1         # Zoom in
Alt+DOWN add video-zoom -0.1      # Zoom out
Alt+0 set video-zoom 0; set video-pan-x 0; set video-pan-y 0    # Reset zoom/pan

# Pan whilst zoomed
Ctrl+UP add video-pan-y -0.05     # Pan up
Ctrl+DOWN add video-pan-y 0.05    # Pan down
Ctrl+LEFT add video-pan-x -0.05   # Pan left
Ctrl+RIGHT add video-pan-x 0.05   # Pan right

# ──────────────────────────────────────────────────────────────────────────
# Aspect ratio and rotation
# ──────────────────────────────────────────────────────────────────────────

# Cycle aspect ratio override
# 16:9 → 4:3 → 2.35:1 → Auto
a cycle-values video-aspect-override "16:9" "4:3" "2.35:1" "-1"

# Rotation (useful for mobile-shot content)
Alt+r add video-rotate 90         # Rotate 90° clockwise
Alt+R add video-rotate -90        # Rotate 90° counter-clockwise

# ──────────────────────────────────────────────────────────────────────────
# Deinterlacing
# ──────────────────────────────────────────────────────────────────────────

# Toggle deinterlacing (auto-detect interlaced content)
d cycle deinterlace

# ============================================================================
# AUDIO CONTROL
# ============================================================================

# ──────────────────────────────────────────────────────────────────────────
# Volume
# ──────────────────────────────────────────────────────────────────────────

= add volume 2         # Increase volume by 2%
+ add volume 2         # Alternative (same key)
- add volume -2        # Decrease volume by 2%
0 set volume 100       # Reset volume to 100%

# Fine volume control
Ctrl+= add volume 1    # Increase volume by 1%
Ctrl+- add volume -1   # Decrease volume by 1%

# ──────────────────────────────────────────────────────────────────────────
# Mute and audio track selection
# ──────────────────────────────────────────────────────────────────────────

m cycle mute           # Toggle mute
# cycle audio          # Cycle audio tracks (default binding, usually '#')
Shift+a cycle audio    # Alternative audio track cycle

# Audio delay adjustment (for A/V sync issues)
Ctrl+Shift+= add audio-delay 0.100    # Delay audio by 100ms
Ctrl+Shift+- add audio-delay -0.100   # Advance audio by 100ms

# ============================================================================
# SUBTITLE CONTROL
# ============================================================================

# cycle sub              # Cycle subtitle tracks (default binding, usually 'v')
Shift+s cycle sub        # Alternative subtitle cycle
Shift+S cycle sub-visibility    # Toggle subtitle visibility

# Subtitle delay adjustment
z add sub-delay -0.1     # Subtitle earlier by 100ms
x add sub-delay +0.1     # Subtitle later by 100ms

# Subtitle font size
Ctrl+Shift+= add sub-scale 0.1      # Increase subtitle size
Ctrl+Shift+- add sub-scale -0.1     # Decrease subtitle size

# ============================================================================
# LOOP CONTROL
# ============================================================================

# Loop current file
l cycle-values loop-file "inf" "no"    # Toggle infinite loop

# A-B loop (set loop points)
L ab-loop                              # Set/clear A-B loop points

# Playlist loop
Shift+l cycle-values loop-playlist "inf" "no"

# ============================================================================
# PLAYLIST & CHAPTER NAVIGATION
# ============================================================================

# ──────────────────────────────────────────────────────────────────────────
# Playlist
# ──────────────────────────────────────────────────────────────────────────

ENTER playlist-next            # Next file in playlist
Shift+ENTER playlist-prev      # Previous file in playlist

# ──────────────────────────────────────────────────────────────────────────
# Chapters
# ──────────────────────────────────────────────────────────────────────────

PGUP add chapter 1             # Next chapter
PGDWN add chapter -1           # Previous chapter

# ============================================================================
# WINDOW & DISPLAY CONTROL
# ============================================================================

# Fullscreen
f cycle fullscreen             # Toggle fullscreen
ESC set fullscreen no          # Exit fullscreen

# Window size presets
Alt+1 set window-scale 0.5     # 50% size
Alt+2 set window-scale 1.0     # 100% size (original)
Alt+3 set window-scale 2.0     # 200% size

# Always on top
T cycle ontop                  # Toggle always-on-top

# ============================================================================
# PROFILES & ADVANCED
# ============================================================================

# Quick profile activation
F2 apply-profile qc-accurate; show-text "Profile: QC Accurate"
F3 apply-profile qc-realtime; show-text "Profile: QC Real-time"
F4 apply-profile hdr; show-text "Profile: HDR"

# ============================================================================
# HELP & REFERENCE
# ============================================================================

# Quick reference card (broadcast-specific shortcuts)
F1 show-text "BROADCAST QC SHORTCUTS:\n─────────────────────────────\nTIMECODE:\n  t = Toggle TC display modes\n  Ctrl+t = Toggle countdown\n\nAUDIO ROUTING:\n  Ctrl+0 = Reset audio (smart downmix)\n  Ctrl+1-8 = Stereo pairs (CH1+2, 3+4, ...)\n  Ctrl+Alt+1-8 = Solo channels\n  Ctrl+l = Cycle loudness targets\n  Ctrl+i = Audio info\n\nPLAYBACK:\n  . / , = Frame step\n  [ / ] = Speed control\n  BS = Normal speed\n  Arrows = Seek (1s/5s)\n  Shift+Arrows = Seek (10s)\n\nQC TOOLS:\n  i = Show metadata\n  s = Screenshot\n  Alt+Arrows = Zoom\n  d = Deinterlace\n  a = Aspect ratio\n\nPress F1 again to close" 10

# Show all keybindings
? show-text "${input-bindings}" 5

# ============================================================================
# QUIT COMMANDS
# ============================================================================

q quit                         # Quit immediately
Q quit-watch-later             # Quit and save position
Ctrl+c quit                    # Alternative quit (console interrupt)

# ============================================================================
# CUSTOM KEYBINDINGS
# ============================================================================
# Add your custom keybindings below this line
# Examples:
#
# Custom screenshot directory:
# Ctrl+s run "/usr/bin/env" "bash" "-c" "mpv --screenshot-directory=/tmp screenshot"
#
# Open file in external editor at current timecode:
# Ctrl+e run "/usr/bin/env" "bash" "-c" "echo ${time-pos} > /tmp/mpv-timecode.txt"
#
# Export timecode to file:
# Ctrl+Shift+e run "/usr/bin/env" "bash" "-c" "echo ${filename} ${time-pos} >> ~/qc-notes.txt"

# ============================================================================
# NOTES
# ============================================================================
#
# Testing Keybindings:
#   Press ? during playback to see all active bindings
#
# Conflicts:
#   If a key doesn't work, check for conflicts with:
#   1. Window manager shortcuts
#   2. Terminal emulator shortcuts (if running in terminal)
#   3. Other mpv scripts
#
# Multiple Commands:
#   KEY command1; command2; command3
#   Commands execute in sequence
#
# Conditional Bindings:
#   KEY {condition} command
#   Example: s {!window-minimized} screenshot
#
# Ignored Keys:
#   #KEY command    (commented out)
#   Lines starting with # are ignored
#
# Documentation:
#   man mpv (search for "INPUT.CONF")
#   https://mpv.io/manual/stable/#input-conf
#
# ============================================================================